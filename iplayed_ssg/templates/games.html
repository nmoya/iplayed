{% extends "base.html" %}

{%- block title -%}
{{ section.title | default(value="Games") }} | {{ config.title }}
{%- endblock -%}

{%- block description -%}
{%- if section.description %}
<meta name="description" content="{{ section.description | markdown(inline=true) | striptags | safe }}">
{%- elif config.description %}
<meta name="description" content="{{ config.description | safe }}">
{%- endif -%}
{%- endblock -%}

{%- block main -%}
{%- set games = paginator.pages | default(value=section.pages) -%}
{%- set enable_search = true -%}
{% include "partials/games_list.html" %}

{%- if paginator and paginator.number_pagers > 1 %}
<nav class="pagination">
    <ul>
        {%- if paginator.previous %}
        <li><a rel="prev" href="{{ paginator.previous | safe }}" aria-label="newer posts">&lt;&nbsp;[newer posts]</a>
        </li>
        {%- endif %}
        {%- if paginator.next %}
        <li><a rel="next" href="{{ paginator.next | safe }}" aria-label="older posts">[older posts]&nbsp;&gt;</a></li>
        {%- endif %}
    </ul>
</nav>
{%- endif %}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const input = document.querySelector('[data-games-search-input]');
        const status = document.querySelector('[data-games-search-status]');
        const cards = Array.from(document.querySelectorAll('[data-game-card]'));

        if (!input || !status || cards.length === 0) {
            return;
        }

        const total = cards.length;

        function update() {
            const query = input.value.trim().toLowerCase();
            let visible = 0;

            cards.forEach((card) => {
                const haystack = card.dataset.searchText || card.textContent.toLowerCase();
                const matches = !query || haystack.includes(query);
                card.hidden = !matches;
                if (matches) {
                    visible += 1;
                }
            });

            const suffix = query ? ` for "${query}"` : '';
            status.textContent = `Showing ${visible} of ${total} games${suffix}`;
        }

        input.addEventListener('input', update);
    });
</script>
{%- endblock -%}
