{% extends "base.html" %}

{%- block title -%}
{{ section.title | default(value="Home") }} | {{ config.title }}
{%- endblock -%}

{%- block description -%}
{%- if section.description %}
<meta name="description" content="{{ section.description | markdown(inline=true) | striptags | safe }}">
{%- endif -%}
{%- endblock -%}

{%- block main -%}
{%- set base_url = config.base_url | trim_end_matches(pat="/") -%}
{%- set completions_url = get_url(path="completions.json") -%}
{%- if completions_url is starting_with(base_url) -%}
{%- set completions_url = completions_url | trim_start_matches(pat=base_url) -%}
{%- endif -%}
{%- if completions_url is not starting_with("/") -%}
{%- set completions_url = "/" ~ completions_url -%}
{%- endif -%}
{%- set games_base_url = get_url(path='games', trailing_slash=true) -%}
{%- if games_base_url is starting_with(base_url) -%}
{%- set games_base_url = games_base_url | trim_start_matches(pat=base_url) -%}
{%- endif -%}
{%- if games_base_url is not starting_with("/") -%}
{%- set games_base_url = "/" ~ games_base_url -%}
{%- endif -%}
<section class="stats content"
    data-stats-root
    data-completions-url="{{ completions_url | safe }}"
    data-games-base-url="{{ games_base_url | safe }}">
    {% if section.content %}
    {{ section.content | markdown | safe }}
    {% endif %}

    <div class="stats-dashboard">

        <article class="stats-card stats-card--highlight">
            <header>
                <h2>Hours Played</h2>
            </header>
            <p id="hoursPlayedDisplay" class="stats-total" aria-live="polite">Loading</p>
            <p id="hoursPlayedSubheading" class="stats-total__caption"></p>
        </article>
        <article class="stats-card">
            <header>
                <h2>Recent Completions</h2>
            </header>
            <div id="recentCompletions" class="stats-list" aria-live="polite"></div>
        </article>


        <article class="stats-card">
            <header class="stats-card__header">
                <div>
                    <h2>Completions per Month</h2>
                    <p class="stats-card__subtitle">Tap a month to see the games you wrapped up.</p>
                </div>
                <div id="year-tabs" class="stats-tabs" role="tablist" aria-label="Years"></div>
            </header>
            <div id="monthly-heatmap" class="stats-heatmap" role="grid" aria-live="polite"></div>
            <div id="month-detail" class="stats-heatmap__detail" aria-live="polite">
                Select a month to view completions.
            </div>
        </article>

        <article class="stats-card">
            <header>
                <h2>Completions per Platform</h2>
            </header>
            <canvas id="platformHistogram" width="420" height="320" aria-label="Completions per platform"></canvas>
            <a href="{{ get_url(path='platforms') }}" class="stats-link">Browse platforms</a>
        </article>

        <article class="stats-card">
            <header>
                <h2>Genre Mix</h2>
                <p class="stats-card__subtitle">Games completed vs. hours invested.</p>
            </header>
            <canvas id="genreComparison" width="420" height="320" aria-label="Genre completion comparison"></canvas>
        </article>

        <article class="stats-card">
            <header>
                <h2>Top Played Game by Genre</h2>
            </header>
            <div id="topGamesByGenre" class="stats-list" aria-live="polite"></div>
            <a href="{{ get_url(path='genres') }}" class="stats-link">Explore genres</a>
        </article>
    </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" defer></script>
<script src="{{ get_url(path="js/stats-dashboard.js", cachebust=true) }}" defer></script>
{%- endblock -%}

