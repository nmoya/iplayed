{% extends "base.html" %}

{%- block title -%}
{{ page.title }} | {{ config.title }}
{%- endblock -%}

{%- block description -%}
{%- if page.description %}
<meta name="description" content="{{ page.description | markdown(inline=true) | striptags }}">
{%- elif page.summary %}
<meta name="description"
  content="{{ page.summary | linebreaksbr | replace(from="<br>", to=" ") | striptags | trim_end_matches(pat=".") | safe }}">
{%- endif %}
{%- endblock -%}

{%- block main -%}
{%- set subtitle = page.extra.subtitle | default(value=page.description | default(value="")) -%}
{%- set completed = page.extra.completed_at | default(value=page.date) -%}
{%- set rating_values = page.taxonomies.rating | default(value=[]) -%}
{%- set platforms = page.taxonomies.platforms | default(value=[]) -%}
{%- set genres = page.taxonomies.genres | default(value=[]) -%}
{%- set cover = page.extra.url_cover_big | default(value=page.extra.url_cover_small | default(value="")) -%}

{%- filter indent -%}{%- filter indent -%}
<article class="post content">
  <header>
    <h1 class="post-title">{{ page.title }}</h1>
  </header>

  {% if cover or subtitle or platforms or genres or rating_values | length > 0 or completed %}
  <section class="terminal-panel" aria-label="Game metadata">
    <div class="terminal-panel__content">
      {% if cover %}
      <figure class="terminal-panel__media">
        <img src="{{ cover | safe }}" alt="{{ page.title | safe }}">
      </figure>
      {% endif %}
      <dl class="terminal-meta">
        {% if subtitle %}
        <dt class="terminal-meta__label">Playtime</dt>
        <dd class="terminal-meta__value">
          <span class="terminal-value">{{ subtitle }}</span>
        </dd>
        {% endif %}
        {% if platforms %}
        <dt class="terminal-meta__label">Platforms</dt>
        <dd class="terminal-meta__value terminal-meta__value--wrap">
          {% for platform in platforms %}
          {% set platform_url = get_taxonomy_url(kind="platforms", name=platform, lang=page.lang) %}
          <a class="terminal-chip" rel="tag" href="{{ platform_url | safe }}">{{ platform }}</a>
          {% endfor %}
        </dd>
        {% endif %}
        {% if genres %}
        <dt class="terminal-meta__label">Genres</dt>
        <dd class="terminal-meta__value terminal-meta__value--wrap">
          {% for genre in genres %}
          {% set genre_url = get_taxonomy_url(kind="genres", name=genre, lang=page.lang) %}
          <a class="terminal-chip" rel="tag" href="{{ genre_url | safe }}">{{ genre }}</a>
          {% endfor %}
        </dd>
        {% endif %}
        {% if rating_values | length > 0 %}
        {% set rating_raw = rating_values | first %}
        {% set rating_value = rating_raw | float %}
        {% set rating_display = rating_raw | trim_end_matches(pat=".0") %}
        {% set rating_percent = (rating_value / 10.0 * 100.0) %}
        <dt class="terminal-meta__label">Rating</dt>
        <dd class="terminal-meta__value">
          <div class="terminal-rating" aria-label="Rating: {{ rating_value }} out of 10">
            <div class="terminal-rating__scale" role="img" aria-label="{{ rating_value }} out of 10">
              <span class="terminal-rating__fill" style="width: {{ rating_percent }}%;"></span>
            </div>
            <span class="terminal-rating__score">{{ rating_display }}/10</span>
          </div>
        </dd>
        {% endif %}
        {% if completed %}
        <dt class="terminal-meta__label">Completed</dt>
        <dd class="terminal-meta__value">
          <time class="terminal-value" datetime="{{ completed }}">{{ completed | date(format="%d %b %Y") }}</time>
        </dd>
        {% endif %}
      </dl>
    </div>
  </section>
  {% endif %}

  {{ page.content | safe }}
</article>


{% endfilter %}{% endfilter %}
{%- endblock -%}